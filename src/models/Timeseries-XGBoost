{
 "cells": [
  {
   "cell_type": "code",
   "execution_count": 38,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<script type=\"text/javascript\">window.PlotlyConfig = {MathJaxConfig: 'local'};</script><script type=\"text/javascript\">if (window.MathJax) {MathJax.Hub.Config({SVG: {font: \"STIX-Web\"}});}</script><script>requirejs.config({paths: { 'plotly': ['https://cdn.plot.ly/plotly-latest.min']},});if(!window._Plotly) {require(['plotly'],function(plotly) {window._Plotly=plotly;});}</script>"
      ],
      "text/vnd.plotly.v1+html": [
       "<script type=\"text/javascript\">window.PlotlyConfig = {MathJaxConfig: 'local'};</script><script type=\"text/javascript\">if (window.MathJax) {MathJax.Hub.Config({SVG: {font: \"STIX-Web\"}});}</script><script>requirejs.config({paths: { 'plotly': ['https://cdn.plot.ly/plotly-latest.min']},});if(!window._Plotly) {require(['plotly'],function(plotly) {window._Plotly=plotly;});}</script>"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "text/html": [
       "<script type=\"text/javascript\">window.PlotlyConfig = {MathJaxConfig: 'local'};</script><script type=\"text/javascript\">if (window.MathJax) {MathJax.Hub.Config({SVG: {font: \"STIX-Web\"}});}</script><script>requirejs.config({paths: { 'plotly': ['https://cdn.plot.ly/plotly-latest.min']},});if(!window._Plotly) {require(['plotly'],function(plotly) {window._Plotly=plotly;});}</script>"
      ],
      "text/vnd.plotly.v1+html": [
       "<script type=\"text/javascript\">window.PlotlyConfig = {MathJaxConfig: 'local'};</script><script type=\"text/javascript\">if (window.MathJax) {MathJax.Hub.Config({SVG: {font: \"STIX-Web\"}});}</script><script>requirejs.config({paths: { 'plotly': ['https://cdn.plot.ly/plotly-latest.min']},});if(!window._Plotly) {require(['plotly'],function(plotly) {window._Plotly=plotly;});}</script>"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    }
   ],
   "source": [
    "# Importing required Libraries\n",
    "\n",
    "import plotly\n",
    "import itertools\n",
    "import pandas as pd\n",
    "import numpy as np\n",
    "import os\n",
    "os.environ['KMP_DUPLICATE_LIB_OK']='True'\n",
    "import seaborn as sns\n",
    "import cufflinks as cf\n",
    "import plotly.offline as py\n",
    "import plotly.figure_factory as ff\n",
    "import plotly.graph_objs as go\n",
    "py.init_notebook_mode(connected=True)\n",
    "cf.go_offline(connected=True)\n",
    "from matplotlib import pyplot as plt\n",
    "plt.style.use('ggplot')\n",
    "%matplotlib inline\n",
    "from xgboost import XGBRegressor\n",
    "from nltk.tokenize import RegexpTokenizer\n",
    "from nltk.corpus import stopwords\n",
    "from gensim.models import Word2Vec\n",
    "from sklearn.model_selection import train_test_split, GridSearchCV\n",
    "from sklearn import preprocessing\n",
    "import statsmodels.api as sm\n",
    "\n",
    "import warnings\n",
    "warnings.filterwarnings('ignore')\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "metadata": {},
   "outputs": [],
   "source": [
    "# Importing the data\n",
    "\n",
    "df_sales = pd.read_csv(\"/Users/satishreddychirra/Document/DS5500 Data Visualization/Sales_Multiseries.csv\")\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "metadata": {
    "scrolled": true
   },
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>Store</th>\n",
       "      <th>Date</th>\n",
       "      <th>Sales</th>\n",
       "      <th>Store_Size</th>\n",
       "      <th>Num_Employees</th>\n",
       "      <th>Returns_Pct</th>\n",
       "      <th>Num_Customers</th>\n",
       "      <th>Pct_On_Sale</th>\n",
       "      <th>Marketing</th>\n",
       "      <th>Near_Xmas</th>\n",
       "      <th>Near_BlackFriday</th>\n",
       "      <th>Holiday</th>\n",
       "      <th>DestinationEvent</th>\n",
       "      <th>Pct_Promotional</th>\n",
       "      <th>Econ_ChangeGDP</th>\n",
       "      <th>EconJobsChange</th>\n",
       "      <th>AnnualizedCPI</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>Louisville</td>\n",
       "      <td>07/01/12</td>\n",
       "      <td>76819.40</td>\n",
       "      <td>20100</td>\n",
       "      <td>42</td>\n",
       "      <td>1.03</td>\n",
       "      <td>327</td>\n",
       "      <td>9.96</td>\n",
       "      <td>July In Store Credit Card Signup Discount; In ...</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>No</td>\n",
       "      <td>No</td>\n",
       "      <td>0.000047</td>\n",
       "      <td>0.5</td>\n",
       "      <td>NaN</td>\n",
       "      <td>0.02</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>Louisville</td>\n",
       "      <td>07/02/12</td>\n",
       "      <td>78963.86</td>\n",
       "      <td>20100</td>\n",
       "      <td>21</td>\n",
       "      <td>0.41</td>\n",
       "      <td>293</td>\n",
       "      <td>8.65</td>\n",
       "      <td>July In Store Credit Card Signup Discount; In ...</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>No</td>\n",
       "      <td>No</td>\n",
       "      <td>0.000047</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>Louisville</td>\n",
       "      <td>07/03/12</td>\n",
       "      <td>74824.71</td>\n",
       "      <td>20100</td>\n",
       "      <td>26</td>\n",
       "      <td>0.31</td>\n",
       "      <td>356</td>\n",
       "      <td>8.96</td>\n",
       "      <td>July In Store Credit Card Signup Discount; In ...</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>No</td>\n",
       "      <td>No</td>\n",
       "      <td>0.000047</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>Louisville</td>\n",
       "      <td>07/04/12</td>\n",
       "      <td>78523.92</td>\n",
       "      <td>20100</td>\n",
       "      <td>33</td>\n",
       "      <td>0.83</td>\n",
       "      <td>350</td>\n",
       "      <td>10.08</td>\n",
       "      <td>July In Store Credit Card Signup Discount; In ...</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>Yes</td>\n",
       "      <td>No</td>\n",
       "      <td>0.000047</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>Louisville</td>\n",
       "      <td>07/05/12</td>\n",
       "      <td>76445.90</td>\n",
       "      <td>20100</td>\n",
       "      <td>38</td>\n",
       "      <td>0.51</td>\n",
       "      <td>299</td>\n",
       "      <td>9.80</td>\n",
       "      <td>July In Store Credit Card Signup Discount; ID5...</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>No</td>\n",
       "      <td>No</td>\n",
       "      <td>0.000047</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "        Store      Date     Sales  Store_Size  Num_Employees  Returns_Pct  \\\n",
       "0  Louisville  07/01/12  76819.40       20100             42         1.03   \n",
       "1  Louisville  07/02/12  78963.86       20100             21         0.41   \n",
       "2  Louisville  07/03/12  74824.71       20100             26         0.31   \n",
       "3  Louisville  07/04/12  78523.92       20100             33         0.83   \n",
       "4  Louisville  07/05/12  76445.90       20100             38         0.51   \n",
       "\n",
       "   Num_Customers  Pct_On_Sale  \\\n",
       "0            327         9.96   \n",
       "1            293         8.65   \n",
       "2            356         8.96   \n",
       "3            350        10.08   \n",
       "4            299         9.80   \n",
       "\n",
       "                                           Marketing  Near_Xmas  \\\n",
       "0  July In Store Credit Card Signup Discount; In ...          0   \n",
       "1  July In Store Credit Card Signup Discount; In ...          0   \n",
       "2  July In Store Credit Card Signup Discount; In ...          0   \n",
       "3  July In Store Credit Card Signup Discount; In ...          0   \n",
       "4  July In Store Credit Card Signup Discount; ID5...          0   \n",
       "\n",
       "   Near_BlackFriday Holiday DestinationEvent  Pct_Promotional  Econ_ChangeGDP  \\\n",
       "0                 0      No               No         0.000047             0.5   \n",
       "1                 0      No               No         0.000047             NaN   \n",
       "2                 0      No               No         0.000047             NaN   \n",
       "3                 0     Yes               No         0.000047             NaN   \n",
       "4                 0      No               No         0.000047             NaN   \n",
       "\n",
       "   EconJobsChange  AnnualizedCPI  \n",
       "0             NaN           0.02  \n",
       "1             NaN            NaN  \n",
       "2             NaN            NaN  \n",
       "3             NaN            NaN  \n",
       "4             NaN            NaN  "
      ]
     },
     "execution_count": 3,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "df_sales.head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "<class 'pandas.core.frame.DataFrame'>\n",
      "RangeIndex: 7140 entries, 0 to 7139\n",
      "Data columns (total 17 columns):\n",
      "Store               7140 non-null object\n",
      "Date                7140 non-null object\n",
      "Sales               7140 non-null float64\n",
      "Store_Size          7140 non-null int64\n",
      "Num_Employees       7140 non-null int64\n",
      "Returns_Pct         7140 non-null float64\n",
      "Num_Customers       7140 non-null int64\n",
      "Pct_On_Sale         7130 non-null float64\n",
      "Marketing           7140 non-null object\n",
      "Near_Xmas           7140 non-null int64\n",
      "Near_BlackFriday    7140 non-null int64\n",
      "Holiday             7140 non-null object\n",
      "DestinationEvent    7140 non-null object\n",
      "Pct_Promotional     7140 non-null float64\n",
      "Econ_ChangeGDP      80 non-null float64\n",
      "EconJobsChange      1020 non-null float64\n",
      "AnnualizedCPI       240 non-null float64\n",
      "dtypes: float64(7), int64(5), object(5)\n",
      "memory usage: 948.4+ KB\n"
     ]
    }
   ],
   "source": [
    "df_sales.info()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>Sales</th>\n",
       "      <th>Store_Size</th>\n",
       "      <th>Num_Employees</th>\n",
       "      <th>Returns_Pct</th>\n",
       "      <th>Num_Customers</th>\n",
       "      <th>Pct_On_Sale</th>\n",
       "      <th>Near_Xmas</th>\n",
       "      <th>Near_BlackFriday</th>\n",
       "      <th>Pct_Promotional</th>\n",
       "      <th>Econ_ChangeGDP</th>\n",
       "      <th>EconJobsChange</th>\n",
       "      <th>AnnualizedCPI</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>count</th>\n",
       "      <td>7140.000000</td>\n",
       "      <td>7140.000000</td>\n",
       "      <td>7140.000000</td>\n",
       "      <td>7140.000000</td>\n",
       "      <td>7140.000000</td>\n",
       "      <td>7130.000000</td>\n",
       "      <td>7140.000000</td>\n",
       "      <td>7140.000000</td>\n",
       "      <td>7140.000000</td>\n",
       "      <td>80.00000</td>\n",
       "      <td>1020.000000</td>\n",
       "      <td>240.000000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>mean</th>\n",
       "      <td>78534.278832</td>\n",
       "      <td>16910.000000</td>\n",
       "      <td>35.048739</td>\n",
       "      <td>0.769146</td>\n",
       "      <td>269.444258</td>\n",
       "      <td>11.711823</td>\n",
       "      <td>2.691877</td>\n",
       "      <td>0.179272</td>\n",
       "      <td>0.065318</td>\n",
       "      <td>1.76250</td>\n",
       "      <td>-590.686275</td>\n",
       "      <td>0.019447</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>std</th>\n",
       "      <td>27445.616100</td>\n",
       "      <td>1927.023634</td>\n",
       "      <td>19.238847</td>\n",
       "      <td>0.469912</td>\n",
       "      <td>226.393313</td>\n",
       "      <td>3.861841</td>\n",
       "      <td>6.958566</td>\n",
       "      <td>0.965183</td>\n",
       "      <td>0.033369</td>\n",
       "      <td>1.84661</td>\n",
       "      <td>5970.650044</td>\n",
       "      <td>0.025387</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>min</th>\n",
       "      <td>0.000000</td>\n",
       "      <td>13400.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>-0.001119</td>\n",
       "      <td>-1.20000</td>\n",
       "      <td>-26000.000000</td>\n",
       "      <td>-0.034766</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>25%</th>\n",
       "      <td>61759.032500</td>\n",
       "      <td>15700.000000</td>\n",
       "      <td>23.000000</td>\n",
       "      <td>0.440000</td>\n",
       "      <td>154.000000</td>\n",
       "      <td>8.940000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.047338</td>\n",
       "      <td>0.40000</td>\n",
       "      <td>-4250.000000</td>\n",
       "      <td>0.009091</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>50%</th>\n",
       "      <td>70776.860000</td>\n",
       "      <td>16750.000000</td>\n",
       "      <td>31.000000</td>\n",
       "      <td>0.680000</td>\n",
       "      <td>207.000000</td>\n",
       "      <td>10.940000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.058358</td>\n",
       "      <td>1.80000</td>\n",
       "      <td>-250.000000</td>\n",
       "      <td>0.020241</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>75%</th>\n",
       "      <td>85319.047500</td>\n",
       "      <td>18800.000000</td>\n",
       "      <td>41.000000</td>\n",
       "      <td>1.000000</td>\n",
       "      <td>287.000000</td>\n",
       "      <td>13.717500</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.075387</td>\n",
       "      <td>3.32500</td>\n",
       "      <td>3000.000000</td>\n",
       "      <td>0.028015</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>max</th>\n",
       "      <td>324414.440000</td>\n",
       "      <td>20100.000000</td>\n",
       "      <td>214.000000</td>\n",
       "      <td>3.090000</td>\n",
       "      <td>2268.000000</td>\n",
       "      <td>31.070000</td>\n",
       "      <td>31.000000</td>\n",
       "      <td>8.000000</td>\n",
       "      <td>0.163078</td>\n",
       "      <td>4.00000</td>\n",
       "      <td>16500.000000</td>\n",
       "      <td>0.073502</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "               Sales    Store_Size  Num_Employees  Returns_Pct  Num_Customers  \\\n",
       "count    7140.000000   7140.000000    7140.000000  7140.000000    7140.000000   \n",
       "mean    78534.278832  16910.000000      35.048739     0.769146     269.444258   \n",
       "std     27445.616100   1927.023634      19.238847     0.469912     226.393313   \n",
       "min         0.000000  13400.000000       0.000000     0.000000       0.000000   \n",
       "25%     61759.032500  15700.000000      23.000000     0.440000     154.000000   \n",
       "50%     70776.860000  16750.000000      31.000000     0.680000     207.000000   \n",
       "75%     85319.047500  18800.000000      41.000000     1.000000     287.000000   \n",
       "max    324414.440000  20100.000000     214.000000     3.090000    2268.000000   \n",
       "\n",
       "       Pct_On_Sale    Near_Xmas  Near_BlackFriday  Pct_Promotional  \\\n",
       "count  7130.000000  7140.000000       7140.000000      7140.000000   \n",
       "mean     11.711823     2.691877          0.179272         0.065318   \n",
       "std       3.861841     6.958566          0.965183         0.033369   \n",
       "min       0.000000     0.000000          0.000000        -0.001119   \n",
       "25%       8.940000     0.000000          0.000000         0.047338   \n",
       "50%      10.940000     0.000000          0.000000         0.058358   \n",
       "75%      13.717500     0.000000          0.000000         0.075387   \n",
       "max      31.070000    31.000000          8.000000         0.163078   \n",
       "\n",
       "       Econ_ChangeGDP  EconJobsChange  AnnualizedCPI  \n",
       "count        80.00000     1020.000000     240.000000  \n",
       "mean          1.76250     -590.686275       0.019447  \n",
       "std           1.84661     5970.650044       0.025387  \n",
       "min          -1.20000   -26000.000000      -0.034766  \n",
       "25%           0.40000    -4250.000000       0.009091  \n",
       "50%           1.80000     -250.000000       0.020241  \n",
       "75%           3.32500     3000.000000       0.028015  \n",
       "max           4.00000    16500.000000       0.073502  "
      ]
     },
     "execution_count": 5,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "df_sales.describe()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "metadata": {},
   "outputs": [],
   "source": [
    "# Extracting date columns\n",
    "\n",
    "df_sales.Date = pd.to_datetime(df_sales.Date, format='%m/%d/%y')\n",
    "df_sales['year'] = pd.DatetimeIndex(df_sales.Date).year\n",
    "df_sales['month'] = pd.DatetimeIndex(df_sales.Date).month\n",
    "df_sales['day'] = pd.DatetimeIndex(df_sales.Date).day\n",
    "df_sales['dayOfWeek'] = pd.DatetimeIndex(df_sales.Date).dayofweek\n",
    "df_sales['quarter'] = pd.DatetimeIndex(df_sales.Date).quarter\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "metadata": {},
   "outputs": [],
   "source": [
    "## Feature Engineering\n",
    "\n",
    "# Deriving rolling Columns\n",
    "def rollingColumns(df, groupbyCol, column, shiftNum, period):\n",
    "    df[column+'_'+str(period)+'day_median'] = df.groupby(groupbyCol)[[column]].shift(\n",
    "        shiftNum).rolling(period, min_periods=1).median().reset_index(0, drop=True)\n",
    "    df[column+'_'+str(period)+'day_mean'] = df.groupby(groupbyCol)[[column]].shift(\n",
    "        shiftNum).rolling(period, min_periods=1).mean().reset_index(0, drop=True)\n",
    "    df[column+'_'+str(period)+'day_std'] = df.groupby(groupbyCol)[[column]].shift(\n",
    "        shiftNum).rolling(period, min_periods=1).std().reset_index(0, drop=True)\n",
    "    df[column+'_'+str(period)+'day_min'] = df.groupby(groupbyCol)[[column]].shift(\n",
    "        shiftNum).rolling(period, min_periods=1).min().reset_index(0, drop=True)\n",
    "    df[column+'_'+str(period)+'day_max'] = df.groupby(groupbyCol)[[column]].shift(\n",
    "        shiftNum).rolling(period, min_periods=1).max().reset_index(0, drop=True)\n",
    "    return df\n",
    "\n",
    "# Deriving lag columns\n",
    "def lagColumns(df, column, num):\n",
    "    df[column+\"_lag\"+str(num)] = df.groupby('Store')[[column]].shift(num)\n",
    "    return df\n",
    "\n",
    "# Deriving diff Columns of the first lag\n",
    "def diffColumns(df, column, num):\n",
    "    df[column+\"_diff\"+str(num)] = df.groupby('Store')[[column]].shift(1).diff(num)\n",
    "    return df\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "metadata": {
    "scrolled": true
   },
   "outputs": [
    {
     "data": {
      "image/png": "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\n",
      "text/plain": [
       "<Figure size 432x288 with 1 Axes>"
      ]
     },
     "execution_count": 8,
     "metadata": {},
     "output_type": "execute_result"
    },
    {
     "data": {
      "image/png": "iVBORw0KGgoAAAANSUhEUgAAAXIAAAEICAYAAABCnX+uAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAALEgAACxIB0t1+/AAAADl0RVh0U29mdHdhcmUAbWF0cGxvdGxpYiB2ZXJzaW9uIDMuMC4yLCBodHRwOi8vbWF0cGxvdGxpYi5vcmcvOIA7rQAAHpNJREFUeJzt3X24HVVh7/HvPjshUUlAFC7Z1voSZQHCxSr3EgQB26KAYtPqXVeR2oQHNTUtUbwoKCpakKtAa1rKVaEQoPXB1aax2AcC995WxUBUXsrlLXNMIBA4vISQF0LgJGfvuX/MzDlz9tnvmTmzZ/bv8zznOXtm9sxea5/kN2vWrJkp+b6PiIjk11DWBRARkb2jIBcRyTkFuYhIzinIRURyTkEuIpJzCnIRkZxTkEtqjDEnGmN8Y8z3ulyvZIz5lDFmdlplS5oxZqMx5s86fO9MY8xnY9MXGWPuTq90UnQKcknTmcBvgI8bY17VxXonAD8AZqRSquydAXwzNn058IGMyiIFoCCXVBhjZgEfBS4B9glfd6qUSqH6x6T6eZ630/O8LVkVRvKvqC0eyd6HgLnALcDtwFnAjRB0JQAf8jzv6OjNxpifAncDVwL/Hs5+0Riz2PO8FcaY9wN/ARwBPB++73LP8/xw/Y8CXwUOAR4Fvux53r+Ey44GvgP8F2AncANwoed5e4wxi4BzgIeBD4fvexvB/423hz8W+Fn4+YuAVwFrgXM8z/PqK26MmQF8A/gE8AbgBeAm4FzgvcB14ft84H3ASfHvo015TwL+KdzWN4HXAj8HzvY879mWfxEpLLXIJS1nAms8z9sMrAJONMa8tYP1NgEfCV/PB35kjDmBYIfwE+B3gC8ThPZnAYwxvwv8iGBHcSRBt4wzxhxujDmEIIQfJgjGTwF/DHwr9pm/A7wIvIsgNCEI4f8F/C5wJ0FofhD478AxgAf8zBizX4M6nBd+xp8Q7AjOA5YCC8NtfY4g3OeF0+M6LO/+wJLwe1oYlufCRl+mDAa1yCVxxpjXAqcBXwpn3QxUgcUEAdyU53lVY8wL4eRznue9bIw5B1jted7F4fxhY8xvEQT63wJ/Ctzsed7l4fLlxph9gVcDHyNoof952HpfZ4z5PHBjeGQQ+Ybnec+E5Q+L4q0Ip18FfB74Pc/z1oTvP8cY8wGCkL2yrhoPAYs8z/tZOL3RGHMecLjneSuNMdsBv+7zIp/uoLxl4FzP8+4J1/97YEGr71WKTS1ySYMl6Bf/ZwDP814AfgosMsb08m/uHcBddfN+AVSMMfsDhwO/ji/0PO8Sz/PuDtddG3XBxNadSdBaBtgVhWrMhtjr+cAs4HZjzM7oJ5xv6tbD87ybAd8Y8x1jzI+NMY+G5Sh3WNd25QUYjr3eES6XAaUWuaThzPD3o7HW5hDBSb73A41uudnq3+LLDeZFJwyHgN1NttnJus3eE58Xle1k4Lm69+2oXzFsOS8DrgVWEhyZ3NSkfK0+N1JfXgjq3Og9MoDUIpdEGWPeBBwHXAS8M/bzboJ+6LMIQmi/2Dol4C2xzdSH8iPAsXXz3kMQqlsJWqfvqivHbcaYz4XrLgg/I77uHia3ultZD4wBB3met97zvPXhuhcB/7XB+5cCX/A87wue590IbATexETYtrp3dBLllQGjFrkk7UzgFWC553nb4guMMdcT9AGvBN5mjPlTghEtfw4cEHvrzvD3u40x9wCXAXcbYy4kOKn5LuACwlErxpjvAneEF+TcSnBS8gSCk4rbCUal/I0x5kqCHcYVwPWe522v659uyPO8ncaYqwj63kcJxsZ/nuBE49cbrLIF+KAx5ucEI3cuIhhdMitWv32NMYcT9IfH/e3ellcGj1rkkrRPAD+qD/HQlQR9uQcD/xO4GLgHqDG56+EB4F8JQv7Tnuf9B/BHwH8DHiQYwfEX4W88z7sL+CTwZwQnGs8CFnqe94jneSPAKQThfz9wDcHIlKVd1uuLBMP+rgP+X7i9Uz3Pa9RKXkQQwA8APyZokf8dwVEJwP8F7gt/PhhfMcHyygAp6QlBIiL5pha5iEjOKchFRHJOQS4iknMKchGRnMti+KHOroqI9KbhhV+ZjCMfGRnpab1KpdLzunmlOg8G1Xkw7E2dK5VK02XqWhERyTkFuYhIzinIRURyTkEuIpJzCnIRkZxTkIuI5FxHww+ttccA33bOnVQ3/3TgawT3ar7WOXd14iUE/M3PUFuxnE0b1sH8QxlatIzSgQen8VEiIrnTtkVurf0iwa00Z9fNnwn8FcETX04EPm2tTSVdayuWw/BDUK3C8EPBtIiIAJ21yDcQ3Av6xrr5hwHrnXNbAay1vwDeC/xjuw22GtjeyKYN6+pKtK7rbeTZINU1ojoPBtU5GW2D3Dm30lr75gaL5hI8fSXyIrHHd7XS9ZVN8w8NWuSx6UG5IkxXvw0G1Xkw9OOVnTuAObHpOUCjp8LstaFFy7hv527GfB8OeQdDi5al8TEiIrm0N/daeQR4u7X2AIJnEJ4AXJ5IqeqUDjyYpY9upVwuc+c1l6bxESIiudV1kFtrzwD2dc79wFp7LnAbQcv+WufcU0kXUEREWusoyJ1zG4EF4esfxub/BPhJKiUTEZGO6IIgEZGcU5CLiOScglxEJOcU5CIiOacgFxHJOQW5iEjOKchFRHJOQS4iknMKchGRnFOQi4jknIJcRCTnFOQiIjmnIBcRyTkFuYhIzinIRURyTkEuIpJzCnIRkZxTkIuI5JyCXEQk5xTkIiI5pyAXEck5BbmISM4pyEVEck5BLiKScwpyEZGcU5CLiOScglxEJOcU5CIiOTej3RustUPAVcBRwChwtnNufWz5/wA+DtSAbznnVqVUVhERaaCTFvlCYLZz7ljgfOCKaIG1dn/gHOBY4P3Ad9MopIiINNdJkB8PrAZwzq0Fjo4tewl4HHhN+FNLuoAiItJa264VYC6wPTZdtdbOcM6NhdObgIeBMnBpJx9aqVS6KiRAuVzued28U50Hg+o8GNKocydBvgOYE5seioX4qcA84C3h9G3W2jXOuV+12uDIyEjXBa1Wq5TL5Z7WzbNKpaI6DwDVeTDsTZ1b7QA66VpZA5wGYK1dADwQW7YVeBkYdc69AmwD9u+plCIi0pNOWuSrgJOttXcCJWCxtfZcYL1z7mZr7e8Da621NeAXwP9Or7giIlKvbZA752rAkrrZ62LLvw58PeFyiYhIh3RBkIhIzinIRURyTkEuIpJzCnIRkZxTkIuI5JyCXEQk5xTkIiI5pyAXEck5BbmISM4pyEVEck5BLiKScwpyEZGcU5CLiORcJ7ex7Vv+5meorVgOG9bB/EMZWrSM0oEHZ10sEZFplesWeW3Fchh+CKpVGH4omBYRGTC5DnI2rGs9LSIyAPId5PMPbT0tIjIAch3kQ4uWcd/O3Yz5PhzyDoYWLcu6SCIi0y7XJztLBx7M0ke3AvDLay7NuDQiItnIdYtcREQU5CIiuacgFxHJOQW5iEjOKchFRHJOQS4iknMKchGRnFOQi4jknIJcRCTn2l7Zaa0dAq4CjgJGgbOdc+tjy08Fvh5O3gssdc75KZRVREQa6KRFvhCY7Zw7FjgfuCJaYK2dA1wGfMg5twDYCLw+hXKKiEgTnQT58cBqAOfcWuDo2LL3AA8AV1hr7wCedc5tTryUIiLSVCc3zZoLbI9NV621M5xzYwSt7/cB7wR2AndYa+9yzg232mClUum6oOVyueG6zeYXSZHr1ozqPBhU52R0EuQ7gDmx6aEwxAG2AL92zj0DYK39OUGotwzykZGRrgtarVYpl8tT1q1Wqz1vMw8qlUph69aM6jwYVOfu122mkyBfA5wOOGvtAoKulMg9wBHW2tcD24AFwNU9lVJERHrSSZCvAk621t4JlIDF1tpzgfXOuZuttRcAt4Xvdc65B1Mqq4iINNA2yJ1zNWBJ3ex1seU3ATclXC4REemQLggSEcm5XD/qrRl/8zPUViyHDetg/qEMLVpG6cCDsy6WiEgqCtkir61YDsMPQbUKww8F09PE3/wM1csuoLrkD6ledgH+5mem7bNFZDAVMsjZsK71dIqy3ImIyGAqZpDPP7T1dJoy3ImIyGAqZJAPLVrGfTt3M+b7cMg7GFq0bPo+PMudiIgMpEIGeenAg1n66FZOeOA5yuddOq0nOjPdiYjIQCrkqJUsRTsRgF9ec2nGpRGRQaAg75GGOIpIvyhk18p00OgUEekXapH3qgCjU3RUIVIMapH3qsvRKf14oZCOKkSKQUHeo25Hp2QVmi13IAU4qhARBXnPuh7imFFottyBaMx74vrxyEuKT0E+XbIKzRY7EI15T566qyQLCvJpkllottiBZHnhVGGpu0oyoCCfJlmFplrd00zdVZIBBXnBqdU9vbTjlCxoHLlM0W/jy/utPK3oFg2SBbXIZYqsh0pu+vAxk0Z86ASiSGsK8jYGcjhZvw2V1AlEkZYU5G0MZGuw34ZK6gSiSEsK8nZSbg32Y4u/34ZK6gSiSGsK8nZSbg0m1eJPcofQb0MlizDyph932FIcCvI2Um8NJtTiL0IXUBTY73t4S24Du5ki/H2kf2n4YRupDyebf2jwHzw+3YsBPCGYp2GJg/j3kemjFnkoq0PfxFr8A3hCMMtWbtf/Xgbw7yPTR0EeyioUkur/HcgTghm2crv99zKQfx+ZNgPXtdL0cDwnh77Nyj8dVxQm1ZWRWJdIUt1Svejy34uu+JQ0tW2RW2uHrLXfs9beZa39qbX2bU3ec6u1dkk6xUxO05ZUTg59s+xOSOqzk9pOpq3cnPx7kcHQSdfKQmC2c+5Y4HzgigbvuRg4IMmCpaZJSyo3h75ZHjkk9dkJbSfLYYm5+fciA6GTrpXjgdUAzrm11tqj4wuttR8FasCtnX5opVLppowAlMvlhut2O/+5w45i9MF7x6dnHXYUB1UqUKlw3OM7ANh4y/WpfHa38yPx+U3L3+P2u1mn1Wd3I8k6tPvuUpPgv5eJTU5zHfqA6pyMToJ8LrA9Nl211s5wzo1Za48AzgA+Cnyt0w8dGRnprpRAtVqlXC5PWbdarTbcZrP5/hlLuO+cRRz5mpnMMEew54wl4+/pdltpz4fgjx6fn2T5u12n1Wd3o10dkvg7T4c0/86DQHXuft1mOgnyHcCc2PSQc24sfP1J4A3AvwFvBnZbazc651b3VNJpkJeTTtEJwU0ZnNRsJqnPzsvfQCQvOgnyNcDpgLPWLgAeiBY4574YvbbWXgQ8088hnifjJwRh/IRg+TyFnohM1UmQrwJOttbeCZSAxdbac4H1zrmbUy3dIMvJcMhWcnXl5YDR36ZY2ga5c64G1A8rnJIqzrmLEiqTQLZjpBOio4r+pb9NsejKzj6Vp+FtTS9XL8BRRWHpb1MoCvI+lac7AfbbRVa6ZWwHdEFToSjIZe/12UVWumVse3k64pP2Bu5eK5KCJv35mQ0zVLdBWxoCWixqkcte67vWXY66DaJuoE0fPkbdQNIzBbnstX57FFuSO5a0+9vVDSRJUJBL4SS5Y0k9aNUNJAlQkIu0knbQ5qgbSPqXglyklZSDNu3zCxqKORgU5CItpB20aV8voD74waDhhzIwerm/SO6H6akPfiCoRS4Do1nrtNDdD+qDHwgKchkcTVqnRe5+6LZrqNA7tQJTkMvgaNY6LXD3Q7dDMYu8UysyBbkMjKat0wJ0PyTWki7wTq3IFOQyMJq1TvvuFgM9SKwl3Yc7NXX3tKcgl4HXb7cY6ElCLel+3Kmpu6c9DT8U6UNdD5VM6IlSfTncUt09balFLtKHum2F9mNLOjF92N3TbxTkIv2oy1ZoIbqHmij0Tioh6loR6UcFePh2Uvqyu6fPqEUu0ocGsRWq0Sm9U5CL9KEid5U0o9EpvVOQi0h/0OiUninIRaQ/aHRKzxTkItKRtPuw83JeoB/78hXkItKRtPuw83JeoB/78hXkItIZ9WEH+vB7aDuO3Fo7BFwFHAWMAmc759bHln8e+Fg4eYtz7htpFFREMqax7YEW30MvT6FKQict8oXAbOfcscD5wBXRAmvtW4FPAO8BjgXeb639z2kUVESy7Z/ttz7srL6LVt9DVt0unVzZeTywGsA5t9Zae3Rs2SbgFOdcFcBaOxN4pd0GK5VK1wUtl8sN1+12fpLbyvv8fixTv83vtzI9t/wiRqPW4PBDzPzh9zjo2z+YlvJQqXDc4zsA2HjL9fRq7OkneeG732TTI/cz67CjOOBzX2PGvN/qukytvotUtfgeNjXodqmvSy/5104nQT4X2B6brlprZzjnxpxze4DnrbUl4DLgPufccLsNjoyMdF3QarVKuVyesm61Wm24zWbze1kny/lJ1Dlv30Wade7X76jTOlcfuX/Se0YfuX98eZbfRTeql31lvGti9MF7efo7X6F83qVdl6nVd5G2pt9Dg26X+HsqlUrPZWy1A+ika2UHMCe+jnNuLJqw1s4G/iF8z2d7KqGIdKYIY62TOlnYh99FVt1PnQT5GuA0AGvtAuCBaEHYEv8X4H7n3GeiLhYRSUe/9VP3JKEA7sfvIqshlJ10rawCTrbW3gmUgMXW2nOB9UAZOBGYZa09NXz/Bc65u1IprciAK8KdAIcWLeOecxZx5GtmMsMc0XMAF+G7SErbIHfO1YAldbPjx0KzEy2RiBRaFMDlcpk7BzyAk6L7kYuIpCwaX74ppfHlurJTRKSBJMeppz2+XEEuInulH28ilYREwzfly/oV5CKyV5oFXu4DPsnwTXmopIJcRPZOk8Drx7sEdiXB8E17qKSCXET2TrPA68O7BHYjyfCNRuq87+EtqYwvV5CLyF5pGngZXXmZVJdOXu6PDgpyEdlLzQIvqysvc9+l0wONIxeRVGR25WXOu3R6oRa5iBRLH95MK20KchEplG67dHI/TBIFuYgUTLcnKYvQp64gF5HBVoA+dQW5iAy2AvSpa9SKiPQt3/cnT1er4PuADz7ha/B3j4ZvGF8x+DVa9wjhuu0BlD7+Ge49b0lwf/S3H07p45/Bf2XX5O2MT9dtf9dLEzMnLfPxd+5ouE4aFOQiGfF9H2o1wkQKwsj3J/8A/ks7g/f4YXjVasH8HduiLQW/ovnbXmBS0NWCB3f5W54bfw++H/QJA/4zT07+zOpYsPoTj05sJ/r8sT3BOo8NTwRTfH7ULREti+avf3hy5ffswa9V8X/zcCzgfNgTvt97cKJeAHt2B7/rtxNun8eGG8/f+BvaKQFLvWcBWHvet+ClF4Of+HYe39B4+5senbrBaNlTj0+eX6uSVuQqyGUg+bVqrEUXC83R0dh0Xatv545YqNUmgvOFzWFg1mIB6eM/9XgwL/qJQm34oYntQxhqteZh9ORjk+dXw0fmPr2p8fxnn6qbHz6B8flnJ88PA57tW+vmh2H/8ktMEYVu1AKunx+VuX5+tf4pkNHOp8n8eIhLWwpy6Uv+nj1hMFbD37UgP7e9MDFdrU60Kp96YiJc61uI463NWtji8+E3TVp2G+vCNL6svoUVBWf9cLUonKJD6/FKRS3YWoffgkhnFOTSlj/eqqwy6XA/CtRoOf7E4fv4YXrUOg2DNgrUsbFg/oZ14TbC9+/ZjV8rw6N1IwfGmrQ2x0Nze12hm7QQ1dIbWP62F/BXr4SRJ6Dy25RO+Qil/Q/IuliJUJAPDD/oNqhVg5ZkrQrVKJzDftJqbWLZWJO+ynaH+80O36cEbW3y9kRS5q9eCU9uDCae3Ii/eiWlj30q0zIlRUHeZ/yo5VudaNX6O3dMtHqjk1c++M+N1PXBBmHqPzY8eX50oqhRt0G1ST+pr75KKZiRJ1pP55iCPGX+2FjQ6qyOTXQ/PPd02L87Fvxu0fr1/VqDvtkwfLduqfuwsJVbfyJKRKDy2xMt8mi6IBTkXfKjft9oPKvv42/bErSGx8aCcI76f4cfnDx2NOp+2Pp8/UajF9NRBZGBVDrlI9z7V5dw5L6zmPHGt1A65SNZFykxAx3k/ljYIh7vNw6Hkz3/bDgv/ImCef3DQZcHdSfSnh2p23BsrK6I9IXS/gewdHgzEI4XL5DCB7n/8i7YMwqjo0Ff8Z7dQQD7Pmx4ZPKboxbzlufqNhIG85SxsCIi2StUkPu1Gry8K7gqKwrrJzY0eKNayiJSHMUI8loN/8nHYNdLky8bFhEZAMUIct+Hl3ZmXQoRkUy0DXJr7RBwFXAUMAqc7ZxbH1v+KeAzwBhwsXPuX1Mqq4iINNDJ/cgXArOdc8cC5wNXRAustQcD5wDHAR8ALrXWzkqjoCIi0lip/n6/9ay1fwn8yjl3Uzj9lHPuDeHrDwOnOeeWhNOrgG85537dYpP+pk+e1nVBn376aQDmzZs3db7vM+/A10+evzkYq10/v9WyvpxfgnmvT2f7mdet2fwU69y331Ef1Xnavosc1Dnx76hUmpJhnXrjDbdAcNfdKToJ8muAlc65W8PpJ4C3OufGrLVnAkc6574ULrsBuME5939abNIfWXx697VotcGxsQa3wxQR6SNDZUozej8tWbnuJ9AkyDvZ6g5gTrw4zrmxJsvmANto55Lvd/CxU1UqFUZGRqYuePpJ2LF16vwCeN3rXseWLVvav7FAVOfBMHB1nrMflaMXNM6wvdRJkK8BTgectXYB8EBs2a+AS6y1s4FZwGHAg4mXUkREmuokyFcBJ1tr7yRo1i+21p4LrHfO3Wyt/WvgDoITp19xzr3SYlsiIpKwtkHunKsBS+pmr4stvxq4OuFydeegebDv3OCKzl07J27bKiIyAApxQVCpXIY5c4MfCB5iu2tncKXn7lHYvVuP1xKRwipEkNcr7TML9pkF+79ufJ6/Z09w86zd4Y2zqmOTn4gzfmtaBb6I5Eshg7yR0syZMHMmvLr1+yY9oac+5KMHQVRjj0uLboWre4mLSEYGJsg7VRoagqGh8Jvp7CLV4GETdQ+WiJ4MNP47fEqQbuYlIglTkCegVCrBjJnBTxv+pJZ91KoPX/u1iQcih0cGpX1mB9uNPaleRCROQT7NSuUylMsdv39WpUJp7sQFBL7vT36wsl+Fmh/sBOLzx3cGsdfjT0PS+QCRIlGQ50ypVAp2BF3sDJoZf/5ordrgvED9zqBuOtpxRDsWHSmIZEZBPsCCLqEZJPHPwPejowI/fCh1beJ3s3m1+PTETqG8/wHwyu7JO4z4j3YaIpMoyCURpVIJSuXObozcxsxKhdKM2U2X+/VHBc2OEsZ3HPEdCVN/409+H37j+fHlNX9iuUjGFOSSO+Mji/rExI6l7lxFo6MJv8F7fZ+hOfvBy6OtdzIQ23FEO5u6eeO/tIMZJApykb2UxI5ln0qF0qzXJFSigF9/hOHHjiL8+FFHfOfR5Ohkyutw3fFfdTuO+iOVBkcuMw48CPyhJtuLfWb8MyaVu9VOrUGZmsxqrUU9/LoXzZ4XHE0P7f15rWYU5CIFFXR3Nbx9dV+YMa9Cye+fI6s807coIpJzCnIRkZxTkIuI5JyCXEQk5xTkIiI5pyAXEck5BbmISM4pyEVEck5BLiKScyV/+m/6o5tAiIj0puGlullcot+/1wyLiOSQulZERHJOQS4iknMKchGRnFOQi4jknIJcRCTnFOQiIjmXiycEWWuHgKuAo4BR4Gzn3PpsS5Uea+0xwLedcydZa98GrCAYf/8gsNQ5V8uyfEmy1s4ErgXeDMwCLgYepth1LgNXAwaoAosJhuWuoKB1BrDWHgTcA5wMjFHw+gJYa+8DtoeTjwHfB5YT1P9259w3kvicvLTIFwKznXPHAucDV2RcntRYa78IXANEj5H/S+BC59x7Cf6z/0FWZUvJmcCWsH6nAldS/DqfDuCcOw74GkF9C13ncIf9feDlcFah6wtgrZ0N4Jw7KfxZDHwPOAM4HjjGWvuuJD4rL0F+PLAawDm3Fjg62+KkagPwR7HpdwM/C1/fCvz+tJcoXf8IfDU2PUbB6+yc+zHw6XDyTcCzFLzOwOUEITYSThe9vhD0ILzaWnu7tfbfrLUnALOccxuccz5wG/B7SXxQXoJ8LhOHJwBVa20uuoW65ZxbCeyJzSqFf3SAF4H9pr9U6XHO7XTOvWitnQP8E3AhBa8zgHNuzFp7PfA3BPUubJ2ttYuAzc6522KzC1vfmF0EO7APAEuA68J5kcTqnZcg3wHMiU0POefGsirMNIv3G84BtmVVkLRYa98I/Dtwo3PuhwxAnQGcc38CHELQX/6q2KKi1fks4GRr7U+BdwI3AAfFlhetvpFh4O+dc75zbpigMXpAbHli9c5LkK8BTgOw1i4AHsi2ONPqPmvtSeHrU4E7MixL4qy1/wm4HfiSc+7acHbR6/zH1toLwsldBDuuu4taZ+fcCc65E51zJwH/AXwSuLWo9Y05i/B8nrW2ArwaeMlaO99aWyJoqSdS77x0T6wi2KPfSXBiZHHG5ZlOXwCuttbuAzxCcBheJF8GXgt81Vob9ZUvA/66wHX+Z+A6a+3PgZnA5wjqWeS/c72i/7sG+DtghbX2FwSjc84i2Gn/A1AmGLXyyyQ+KIvb2IqISILy0rUiIiJNKMhFRHJOQS4iknMKchGRnFOQi4jknIJcRCTnFOQiIjn3/wF6EAB10qQ3mAAAAABJRU5ErkJggg==\n",
      "text/plain": [
       "<Figure size 432x288 with 1 Axes>"
      ]
     },
     "metadata": {
      "needs_background": "light"
     },
     "output_type": "display_data"
    }
   ],
   "source": [
    "# Autocorrelation of the target feature\n",
    "\n",
    "sm.tsa.graphics.plot_acf(df_sales['Sales'], lags=50)\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 9,
   "metadata": {},
   "outputs": [],
   "source": [
    "# Target Derived Columns\n",
    "\n",
    "# Moving Averages based \n",
    "mvPeriods = [7, 14, 21, 28]\n",
    "for i in mvPeriods:\n",
    "    df_sales = rollingColumns(df_sales, 'Store', 'Sales', 1, i)\n",
    "    \n",
    "# Lags \n",
    "lagPeriods = [1, 2, 3, 4, 5, 6, 7]\n",
    "for i in lagPeriods:\n",
    "    df_sales = lagColumns(df_sales, 'Sales', i)\n",
    "\n",
    "# Diff columns\n",
    "df_sales = diffColumns(df_sales, 'Sales', 1)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 10,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>Sales</th>\n",
       "      <th>Sales_7day_median</th>\n",
       "      <th>Sales_7day_mean</th>\n",
       "      <th>Sales_7day_std</th>\n",
       "      <th>Sales_7day_min</th>\n",
       "      <th>Sales_7day_max</th>\n",
       "      <th>Sales_14day_median</th>\n",
       "      <th>Sales_14day_mean</th>\n",
       "      <th>Sales_14day_std</th>\n",
       "      <th>Sales_14day_min</th>\n",
       "      <th>...</th>\n",
       "      <th>Sales_28day_min</th>\n",
       "      <th>Sales_28day_max</th>\n",
       "      <th>Sales_lag1</th>\n",
       "      <th>Sales_lag2</th>\n",
       "      <th>Sales_lag3</th>\n",
       "      <th>Sales_lag4</th>\n",
       "      <th>Sales_lag5</th>\n",
       "      <th>Sales_lag6</th>\n",
       "      <th>Sales_lag7</th>\n",
       "      <th>Sales_diff1</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>76819.40</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>78963.86</td>\n",
       "      <td>76819.40</td>\n",
       "      <td>76819.400000</td>\n",
       "      <td>NaN</td>\n",
       "      <td>76819.40</td>\n",
       "      <td>76819.40</td>\n",
       "      <td>76819.400</td>\n",
       "      <td>76819.400000</td>\n",
       "      <td>NaN</td>\n",
       "      <td>76819.40</td>\n",
       "      <td>...</td>\n",
       "      <td>76819.40</td>\n",
       "      <td>76819.40</td>\n",
       "      <td>76819.40</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>74824.71</td>\n",
       "      <td>77891.63</td>\n",
       "      <td>77891.630000</td>\n",
       "      <td>1516.362208</td>\n",
       "      <td>76819.40</td>\n",
       "      <td>78963.86</td>\n",
       "      <td>77891.630</td>\n",
       "      <td>77891.630000</td>\n",
       "      <td>1516.362208</td>\n",
       "      <td>76819.40</td>\n",
       "      <td>...</td>\n",
       "      <td>76819.40</td>\n",
       "      <td>78963.86</td>\n",
       "      <td>78963.86</td>\n",
       "      <td>76819.40</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>2144.46</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>78523.92</td>\n",
       "      <td>76819.40</td>\n",
       "      <td>76869.323333</td>\n",
       "      <td>2070.026554</td>\n",
       "      <td>74824.71</td>\n",
       "      <td>78963.86</td>\n",
       "      <td>76819.400</td>\n",
       "      <td>76869.323333</td>\n",
       "      <td>2070.026554</td>\n",
       "      <td>74824.71</td>\n",
       "      <td>...</td>\n",
       "      <td>74824.71</td>\n",
       "      <td>78963.86</td>\n",
       "      <td>74824.71</td>\n",
       "      <td>78963.86</td>\n",
       "      <td>76819.40</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>-4139.15</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>76445.90</td>\n",
       "      <td>77671.66</td>\n",
       "      <td>77282.972500</td>\n",
       "      <td>1881.779961</td>\n",
       "      <td>74824.71</td>\n",
       "      <td>78963.86</td>\n",
       "      <td>77671.660</td>\n",
       "      <td>77282.972500</td>\n",
       "      <td>1881.779961</td>\n",
       "      <td>74824.71</td>\n",
       "      <td>...</td>\n",
       "      <td>74824.71</td>\n",
       "      <td>78963.86</td>\n",
       "      <td>78523.92</td>\n",
       "      <td>74824.71</td>\n",
       "      <td>78963.86</td>\n",
       "      <td>76819.40</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>3699.21</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5</th>\n",
       "      <td>85096.96</td>\n",
       "      <td>76819.40</td>\n",
       "      <td>77115.558000</td>\n",
       "      <td>1672.112419</td>\n",
       "      <td>74824.71</td>\n",
       "      <td>78963.86</td>\n",
       "      <td>76819.400</td>\n",
       "      <td>77115.558000</td>\n",
       "      <td>1672.112419</td>\n",
       "      <td>74824.71</td>\n",
       "      <td>...</td>\n",
       "      <td>74824.71</td>\n",
       "      <td>78963.86</td>\n",
       "      <td>76445.90</td>\n",
       "      <td>78523.92</td>\n",
       "      <td>74824.71</td>\n",
       "      <td>78963.86</td>\n",
       "      <td>76819.40</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>-2078.02</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>6</th>\n",
       "      <td>86807.56</td>\n",
       "      <td>77671.66</td>\n",
       "      <td>78445.791667</td>\n",
       "      <td>3585.233270</td>\n",
       "      <td>74824.71</td>\n",
       "      <td>85096.96</td>\n",
       "      <td>77671.660</td>\n",
       "      <td>78445.791667</td>\n",
       "      <td>3585.233270</td>\n",
       "      <td>74824.71</td>\n",
       "      <td>...</td>\n",
       "      <td>74824.71</td>\n",
       "      <td>85096.96</td>\n",
       "      <td>85096.96</td>\n",
       "      <td>76445.90</td>\n",
       "      <td>78523.92</td>\n",
       "      <td>74824.71</td>\n",
       "      <td>78963.86</td>\n",
       "      <td>76819.40</td>\n",
       "      <td>NaN</td>\n",
       "      <td>8651.06</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>7</th>\n",
       "      <td>78133.71</td>\n",
       "      <td>78523.92</td>\n",
       "      <td>79640.330000</td>\n",
       "      <td>4549.729019</td>\n",
       "      <td>74824.71</td>\n",
       "      <td>86807.56</td>\n",
       "      <td>78523.920</td>\n",
       "      <td>79640.330000</td>\n",
       "      <td>4549.729019</td>\n",
       "      <td>74824.71</td>\n",
       "      <td>...</td>\n",
       "      <td>74824.71</td>\n",
       "      <td>86807.56</td>\n",
       "      <td>86807.56</td>\n",
       "      <td>85096.96</td>\n",
       "      <td>76445.90</td>\n",
       "      <td>78523.92</td>\n",
       "      <td>74824.71</td>\n",
       "      <td>78963.86</td>\n",
       "      <td>76819.40</td>\n",
       "      <td>1710.60</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>8</th>\n",
       "      <td>74186.36</td>\n",
       "      <td>78523.92</td>\n",
       "      <td>79828.088571</td>\n",
       "      <td>4439.701372</td>\n",
       "      <td>74824.71</td>\n",
       "      <td>86807.56</td>\n",
       "      <td>78328.815</td>\n",
       "      <td>79452.002500</td>\n",
       "      <td>4245.777242</td>\n",
       "      <td>74824.71</td>\n",
       "      <td>...</td>\n",
       "      <td>74824.71</td>\n",
       "      <td>86807.56</td>\n",
       "      <td>78133.71</td>\n",
       "      <td>86807.56</td>\n",
       "      <td>85096.96</td>\n",
       "      <td>76445.90</td>\n",
       "      <td>78523.92</td>\n",
       "      <td>74824.71</td>\n",
       "      <td>78963.86</td>\n",
       "      <td>-8673.85</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>9</th>\n",
       "      <td>73390.55</td>\n",
       "      <td>78133.71</td>\n",
       "      <td>79145.588571</td>\n",
       "      <td>4934.356698</td>\n",
       "      <td>74186.36</td>\n",
       "      <td>86807.56</td>\n",
       "      <td>78133.710</td>\n",
       "      <td>78866.931111</td>\n",
       "      <td>4342.127717</td>\n",
       "      <td>74186.36</td>\n",
       "      <td>...</td>\n",
       "      <td>74186.36</td>\n",
       "      <td>86807.56</td>\n",
       "      <td>74186.36</td>\n",
       "      <td>78133.71</td>\n",
       "      <td>86807.56</td>\n",
       "      <td>85096.96</td>\n",
       "      <td>76445.90</td>\n",
       "      <td>78523.92</td>\n",
       "      <td>74824.71</td>\n",
       "      <td>-3947.35</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>10 rows  29 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "      Sales  Sales_7day_median  Sales_7day_mean  Sales_7day_std  \\\n",
       "0  76819.40                NaN              NaN             NaN   \n",
       "1  78963.86           76819.40     76819.400000             NaN   \n",
       "2  74824.71           77891.63     77891.630000     1516.362208   \n",
       "3  78523.92           76819.40     76869.323333     2070.026554   \n",
       "4  76445.90           77671.66     77282.972500     1881.779961   \n",
       "5  85096.96           76819.40     77115.558000     1672.112419   \n",
       "6  86807.56           77671.66     78445.791667     3585.233270   \n",
       "7  78133.71           78523.92     79640.330000     4549.729019   \n",
       "8  74186.36           78523.92     79828.088571     4439.701372   \n",
       "9  73390.55           78133.71     79145.588571     4934.356698   \n",
       "\n",
       "   Sales_7day_min  Sales_7day_max  Sales_14day_median  Sales_14day_mean  \\\n",
       "0             NaN             NaN                 NaN               NaN   \n",
       "1        76819.40        76819.40           76819.400      76819.400000   \n",
       "2        76819.40        78963.86           77891.630      77891.630000   \n",
       "3        74824.71        78963.86           76819.400      76869.323333   \n",
       "4        74824.71        78963.86           77671.660      77282.972500   \n",
       "5        74824.71        78963.86           76819.400      77115.558000   \n",
       "6        74824.71        85096.96           77671.660      78445.791667   \n",
       "7        74824.71        86807.56           78523.920      79640.330000   \n",
       "8        74824.71        86807.56           78328.815      79452.002500   \n",
       "9        74186.36        86807.56           78133.710      78866.931111   \n",
       "\n",
       "   Sales_14day_std  Sales_14day_min  ...  Sales_28day_min  Sales_28day_max  \\\n",
       "0              NaN              NaN  ...              NaN              NaN   \n",
       "1              NaN         76819.40  ...         76819.40         76819.40   \n",
       "2      1516.362208         76819.40  ...         76819.40         78963.86   \n",
       "3      2070.026554         74824.71  ...         74824.71         78963.86   \n",
       "4      1881.779961         74824.71  ...         74824.71         78963.86   \n",
       "5      1672.112419         74824.71  ...         74824.71         78963.86   \n",
       "6      3585.233270         74824.71  ...         74824.71         85096.96   \n",
       "7      4549.729019         74824.71  ...         74824.71         86807.56   \n",
       "8      4245.777242         74824.71  ...         74824.71         86807.56   \n",
       "9      4342.127717         74186.36  ...         74186.36         86807.56   \n",
       "\n",
       "   Sales_lag1  Sales_lag2  Sales_lag3  Sales_lag4  Sales_lag5  Sales_lag6  \\\n",
       "0         NaN         NaN         NaN         NaN         NaN         NaN   \n",
       "1    76819.40         NaN         NaN         NaN         NaN         NaN   \n",
       "2    78963.86    76819.40         NaN         NaN         NaN         NaN   \n",
       "3    74824.71    78963.86    76819.40         NaN         NaN         NaN   \n",
       "4    78523.92    74824.71    78963.86    76819.40         NaN         NaN   \n",
       "5    76445.90    78523.92    74824.71    78963.86    76819.40         NaN   \n",
       "6    85096.96    76445.90    78523.92    74824.71    78963.86    76819.40   \n",
       "7    86807.56    85096.96    76445.90    78523.92    74824.71    78963.86   \n",
       "8    78133.71    86807.56    85096.96    76445.90    78523.92    74824.71   \n",
       "9    74186.36    78133.71    86807.56    85096.96    76445.90    78523.92   \n",
       "\n",
       "   Sales_lag7  Sales_diff1  \n",
       "0         NaN          NaN  \n",
       "1         NaN          NaN  \n",
       "2         NaN      2144.46  \n",
       "3         NaN     -4139.15  \n",
       "4         NaN      3699.21  \n",
       "5         NaN     -2078.02  \n",
       "6         NaN      8651.06  \n",
       "7    76819.40      1710.60  \n",
       "8    78963.86     -8673.85  \n",
       "9    74824.71     -3947.35  \n",
       "\n",
       "[10 rows x 29 columns]"
      ]
     },
     "execution_count": 10,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# Target derived columns\n",
    "\n",
    "targetCols = [col for col in df_sales.columns if \"Sales\" in col]\n",
    "df_sales[targetCols].head(10)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 11,
   "metadata": {
    "scrolled": true
   },
   "outputs": [],
   "source": [
    "# Calculating Moving averages for quantitative features\n",
    "\n",
    "quantitativeCols = ['Store_Size', 'Num_Employees', 'Returns_Pct', 'Num_Customers', 'Pct_On_Sale', 'Pct_Promotional']\n",
    "\n",
    "for col in quantitativeCols:\n",
    "    for i in mvPeriods:\n",
    "        df_sales = rollingColumns(df_sales, 'Store', col, 0, i)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 12,
   "metadata": {},
   "outputs": [],
   "source": [
    "# Calculating lags for quantitative features\n",
    "\n",
    "for col in quantitativeCols:\n",
    "    for i in lagPeriods:\n",
    "        df_sales = lagColumns(df_sales, col, i)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 13,
   "metadata": {},
   "outputs": [],
   "source": [
    "# Calculating diff columns for quantitative features\n",
    "\n",
    "for col in quantitativeCols:\n",
    "        df_sales = diffColumns(df_sales, col, 1)\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 14,
   "metadata": {},
   "outputs": [],
   "source": [
    "# One-Hot encoding for 'Store'\n",
    "\n",
    "df_sales[list(pd.get_dummies(df_sales.Store).columns)] = pd.get_dummies(df_sales.Store)\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 15,
   "metadata": {},
   "outputs": [],
   "source": [
    "# Converting features 'Holiday' and 'DestinationEvent' to numerical\n",
    "\n",
    "df_sales['Holiday'] = np.where(df_sales['Holiday'] == 'Yes', 1, 0)\n",
    "df_sales['DestinationEvent'] = np.where(df_sales['DestinationEvent'] == 'Yes', 1, 0)\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 16,
   "metadata": {},
   "outputs": [],
   "source": [
    "### Feature Engineering in progress\n",
    "\n",
    "# Word2Vec model (Google/Wiki/Train)\n",
    "\n",
    "def remove_stopwords(sentence, language):\n",
    "    tokenizer = RegexpTokenizer(r'\\w+')\n",
    "    return [token for token in tokenizer.tokenize(sentence) if token.lower() not in stopwords.words(language)]\n",
    "\n",
    "\n",
    "# PCA to get Principle components\n",
    "\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 17,
   "metadata": {},
   "outputs": [],
   "source": [
    "# Taking the length of text feature 'Marketing'\n",
    "\n",
    "df_sales['MarketingLen'] = [len(text) for text in df_sales['Marketing']]\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 18,
   "metadata": {},
   "outputs": [],
   "source": [
    "# Using Forward filling to minimize nan values for the economic indicator features\n",
    "\n",
    "df_sales['Econ_ChangeGDP'] = df_sales['Econ_ChangeGDP'].fillna(method='ffill')\n",
    "df_sales['EconJobsChange'] = df_sales['EconJobsChange'].fillna(method='ffill')\n",
    "df_sales['AnnualizedCPI'] = df_sales['AnnualizedCPI'].fillna(method='ffill')\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 19,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "(7140, 229)"
      ]
     },
     "execution_count": 19,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# Printing the shape of dataframe\n",
    "\n",
    "df_sales.shape"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 20,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "((5490, 229), (1650, 229))"
      ]
     },
     "execution_count": 20,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# Dividing the data into train and test\n",
    "\n",
    "train, test = df_sales[df_sales.Date < '2014-01-01'], df_sales[df_sales.Date >= '2014-01-01']\n",
    "\n",
    "train.shape, test.shape"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 21,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>Sales</th>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Store</th>\n",
       "      <th></th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>Baltimore</th>\n",
       "      <td>549</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Columbus</th>\n",
       "      <td>549</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Detroit</th>\n",
       "      <td>549</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Lancaster</th>\n",
       "      <td>549</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Louisville</th>\n",
       "      <td>549</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Philadelphia</th>\n",
       "      <td>549</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Portland</th>\n",
       "      <td>549</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Richmond</th>\n",
       "      <td>549</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>San Antonio</th>\n",
       "      <td>549</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Savannah</th>\n",
       "      <td>549</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "              Sales\n",
       "Store              \n",
       "Baltimore       549\n",
       "Columbus        549\n",
       "Detroit         549\n",
       "Lancaster       549\n",
       "Louisville      549\n",
       "Philadelphia    549\n",
       "Portland        549\n",
       "Richmond        549\n",
       "San Antonio     549\n",
       "Savannah        549"
      ]
     },
     "execution_count": 21,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "train.groupby('Store')[['Sales']].count()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 22,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>Sales</th>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Store</th>\n",
       "      <th></th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>Baltimore</th>\n",
       "      <td>165</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Columbus</th>\n",
       "      <td>165</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Detroit</th>\n",
       "      <td>165</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Lancaster</th>\n",
       "      <td>165</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Louisville</th>\n",
       "      <td>165</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Philadelphia</th>\n",
       "      <td>165</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Portland</th>\n",
       "      <td>165</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Richmond</th>\n",
       "      <td>165</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>San Antonio</th>\n",
       "      <td>165</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Savannah</th>\n",
       "      <td>165</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "              Sales\n",
       "Store              \n",
       "Baltimore       165\n",
       "Columbus        165\n",
       "Detroit         165\n",
       "Lancaster       165\n",
       "Louisville      165\n",
       "Philadelphia    165\n",
       "Portland        165\n",
       "Richmond        165\n",
       "San Antonio     165\n",
       "Savannah        165"
      ]
     },
     "execution_count": 22,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "test.groupby('Store')[['Sales']].count()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 23,
   "metadata": {},
   "outputs": [],
   "source": [
    "# Dividing features and target for both train and test datasets\n",
    "\n",
    "X_train, Y_train = train.drop('Sales', axis=1), train.Sales\n",
    "X_test, Y_test = test.drop('Sales', axis=1), test.Sales\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 24,
   "metadata": {},
   "outputs": [],
   "source": [
    "# Droping columns 'Date', 'Store' and 'Marketing'\n",
    "\n",
    "X_train.drop(['Date','Store','Marketing'], axis=1, inplace=True)\n",
    "X_test.drop(['Date','Store','Marketing'], axis=1, inplace=True)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 25,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "((5490, 225), (5490,), (1650, 225), (1650,))"
      ]
     },
     "execution_count": 25,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# Printing the shapes\n",
    "\n",
    "X_train.shape, Y_train.shape, X_test.shape, Y_test.shape"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 26,
   "metadata": {},
   "outputs": [],
   "source": [
    "# Normalizing the train data\n",
    "\n",
    "scaler = preprocessing.MinMaxScaler()\n",
    "\n",
    "X_train_scaled = scaler.fit_transform(X_train.fillna(0))\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 28,
   "metadata": {},
   "outputs": [],
   "source": [
    "model = XGBRegressor(max_depth=5, learning_rate=0.05, n_estimators=100, n_jobs=-1)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 29,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "XGBRegressor(base_score=0.5, booster='gbtree', colsample_bylevel=1,\n",
       "       colsample_bytree=1, gamma=0, learning_rate=0.05, max_delta_step=0,\n",
       "       max_depth=5, min_child_weight=1, missing=None, n_estimators=100,\n",
       "       n_jobs=-1, nthread=None, objective='reg:linear', random_state=0,\n",
       "       reg_alpha=0, reg_lambda=1, scale_pos_weight=1, seed=None,\n",
       "       silent=True, subsample=1)"
      ]
     },
     "execution_count": 29,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "model.fit(X_train_scaled, Y_train)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 34,
   "metadata": {},
   "outputs": [],
   "source": [
    "# Normalizing test data\n",
    "\n",
    "X_test_scaled = scaler.transform(X_test.fillna(0))"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 40,
   "metadata": {},
   "outputs": [],
   "source": [
    "# Prediction on test data \n",
    "\n",
    "y_pred = model.predict(X_test_scaled)\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.6.8"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 2
}
